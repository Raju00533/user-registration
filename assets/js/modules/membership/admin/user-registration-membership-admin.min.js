!function(l,p){UR_Snackbar&&(t=new UR_Snackbar),l(".user-membership-enhanced-select2").select2();var t,u={append_spinner:function(e){return!(!e||!e.append||(e.append('<span class="ur-spinner is-active"></span>'),0))},prepend_spinner:function(e){return!(!e||!e.prepend||(e.prepend('<span class="ur-spinner is-active"></span>'),0))},remove_spinner:function(e){return!(!e||!e.remove||(e.find(".ur-spinner").remove(),0))},if_empty:function(e,t){return null===e||undefined===e||""===e?t:e},toggleSaveButtons:function(e){e=u.if_empty(e,!0),l(".ur-membership-save-btn").prop("disabled",!!e)},show_success_message:function(e){return!!t&&(t.add({type:"success",message:e,duration:5}),!0)},show_failure_message:function(e){return!!t&&(t.add({type:"failure",message:e,duration:6}),!0)},convert_to_timestamp:function(e,t){var a;switch(t){case"day":a=864e5;break;case"week":a=6048e5;break;case"month":a=2592e6;break;case"year":a=31536e6;break;default:return null}return(new Date).getTime()+e*a},regular_validation:function(e,i){return e.every(function(e){var e=l(e),t=e.val(),a=e.attr("required"),s=e.attr("type"),e=e.data("key-name");return a&&""===t?(i=!1,u.show_failure_message(p.labels.i18n_error+"! "+e+" "+p.labels.i18n_field_is_required),!1):!("url"===s&&!u.url_validations(t)&&(i=!1,u.show_failure_message(p.labels.i18n_error+"! "+e+" "+p.labels.i18n_valid_url_field_validation+" "+e),1))}),i},url_validations:function(e){return new RegExp("^https?:\\/\\/(?:www\\.)?[-a-zA-Z0-9@:%._\\+~#=]{1,256}\\.[a-zA-Z0-9()]{1,6}\\b(?:[-a-zA-Z0-9()@:%_\\+.~#?&\\/=]*)$").test(e)},handle_bulk_delete_action:function(s){Swal.fire({title:'<img src="'+p.delete_icon+'" id="delete-user-icon">'+p.labels.i18n_prompt_title,html:'<p id="html_1">'+p.labels.i18n_prompt_bulk_subtitle+"</p>",showCancelButton:!0,confirmButtonText:p.labels.i18n_prompt_delete,cancelButtonText:p.labels.i18n_prompt_cancel,allowOutsideClick:!1}).then(function(e){var t,a;e.isConfirmed&&(t=s.find('input[name="membership[]"]:checked'),a=[],t.length<1?u.show_failure_message(p.labels.i18n_prompt_no_membership_selected):(t.each(function(){""!==l(this).val()&&a.push(l(this).val())}),i.send_data({action:"user_registration_membership_delete_memberships",membership_ids:JSON.stringify(a)},{success:function(e){e.success?(u.show_success_message(e.data.message),i.remove_deleted_memberships(t,!0)):u.show_failure_message(e.data.message)},failure:function(e,t){u.show_failure_message(p.labels.network_error+"("+t+")")},complete:function(){window.location.reload()}})))})}},i={prepare_membership_data:function(){var e,t,a,s={},i={},r=l("#ur-membership-create-form"),s={name:r.find("#ur-input-type-membership-name").val(),description:r.find("#ur-input-type-membership-description").val(),status:r.find("#ur-membership-status").prop("checked")};return p.membership_id&&(s.ID=p.membership_id),i.type=r.find('input[name="ur_membership_type"]:checked').val(),i.cancel_subscription=r.find('input[name="ur_membership_cancel_on"]:checked').val(),i.role=r.find("#ur-input-type-membership-role").find(":selected").val(),"free"!==i.type&&("paid"!==i.type&&(i.subscription={value:r.find("#ur-membership-duration-value").val(),duration:r.find("#ur-membership-duration").val()},i.trial_status=r.find("#ur-membership-trial-status").val(),"on"===i.trial_status&&(i.trial_data={value:r.find("#ur-membership-trial-duration-value").val(),duration:r.find("#ur-membership-trial-duration").val()}),i.cancel_subscription=r.find('input[name="ur_membership_cancel_on"]:checked').val()),i.amount=r.find("#ur-membership-amount").val(),a=r.find("#ur-membership-pg-paypal:checked").val(),e=r.find("#ur-membership-pg-bank:checked").val(),t=r.find("#ur-membership-pg-stripe:checked").val(),i.payment_gateways={paypal:{status:"off"},stripe:{status:"off"},bank:{status:"off"}},a&&(i.payment_gateways.paypal={status:a,email:r.find("#ur-input-type-paypal-email").val(),mode:r.find("#ur-membership-paypal-mode").val(),payment_type:r.find("#ur-membership-paypal-payment-type").val(),cancel_url:r.find("#ur-input-type-cancel-url").val(),return_url:r.find("#ur-input-type-return-url").val()},"subscription"===i.type)&&(i.payment_gateways.paypal.client_id=r.find("#ur-input-type-client-id").val(),i.payment_gateways.paypal.client_secret=r.find("#ur-input-type-client-secret").val()),e&&(a=(a=tinyMCE.get("bank_transfer_field").getContent()).replace(/(<img[^>]*?)(")([^>]*?>)/g,function(e,t,a,s){return t+"'"+s.replace(/"/g,"'")}),i.payment_gateways.bank={status:e,content:a}),t)&&(i.payment_gateways.stripe={status:t}),{post_data:s,post_meta_data:i}},validate_membership_form:function(){var e,t,a,s,i=l("#ur-membership-plan-and-price-section"),r=l("#ur-membership-main-fields").find("input"),n=l("#ur-membership-create-form"),o=!0,r=Object.values(r).reverse().slice(2);return!!u.regular_validation(r,!0)&&(r=i.find('input[name="ur_membership_type"]:checked').val(),i=i.find("#ur-membership-amount").val(),!!("paid"!==r&&"subscription"!==r||(i<=0&&(o=!1,u.show_failure_message(p.labels.i18n_error+"! "+p.labels.i18n_valid_amount_field_validation)),"on"===l("#ur-membership-trial-status").val()&&"subscription"===r&&(i=l("#ur-membership-trial-duration").val(),e=l("#ur-membership-trial-duration-value").val(),t=l("#ur-membership-duration").val(),s=l("#ur-membership-duration-value").val(),i=u.convert_to_timestamp(parseInt(e,10),i),u.convert_to_timestamp(parseInt(s,10),t)<=i&&(o=!1,u.show_failure_message(p.labels.i18n_error+"! "+p.labels.i18n_valid_trial_period_field_validation)),s<1&&(o=!1,u.show_failure_message(p.labels.i18n_error+"! "+p.labels.i18n_valid_min_subs_period_field_validation)),e<1)&&(o=!1,u.show_failure_message(p.labels.i18n_error+"! "+p.labels.i18n_valid_min_trial_period_field_validation)),t=l("#payment-gateway-container .user-registration-switch"),a=!1,t.each(function(e,t){l(t).find("input").is(":checked")&&(a=!0)}),a||(o=!1,u.show_failure_message(p.labels.i18n_error+"! "+p.labels.i18n_pg_validation_error)),!n.find("#ur-membership-pg-paypal:checked").val())||(s=(i=l("#paypal-section")).find("input"),"subscription"!==r&&(s=i.find("input").not('[name^="ur_membership_client_"]')),s=Object.values(s).reverse().slice(2).reverse(),u.regular_validation(s,!0))))&&o},create_membership:function(a){var e;u.toggleSaveButtons(!0),u.append_spinner(a),this.validate_membership_form()?(e=this.prepare_membership_data(),this.send_data({action:"user_registration_membership_create_membership",membership_data:JSON.stringify(e)},{success:function(e){var t;e.success?(p.membership_id=e.data.membership_id,a.text(p.labels.i18n_save),u.show_success_message(e.data.message),t=l(location).attr("href"),t+="&post_id="+p.membership_id,l(location).attr("href",t)):u.show_failure_message(e.data.message)},failure:function(e,t){u.show_failure_message(p.labels.network_error+"("+t+")")},complete:function(){u.remove_spinner(a),u.toggleSaveButtons(!1)}})):(u.remove_spinner(a),u.toggleSaveButtons(!1))},update_membership:function(e){var t;u.toggleSaveButtons(!0),u.append_spinner(e),this.validate_membership_form()?(t=this.prepare_membership_data(),this.send_data({action:"user_registration_membership_update_membership",membership_data:JSON.stringify(t),membership_id:p.membership_id},{success:function(e){e.success?u.show_success_message(e.data.message):u.show_failure_message(e.data.message)},failure:function(e,t){u.show_failure_message(p.labels.network_error+"("+t+")")},complete:function(){u.remove_spinner(e),u.toggleSaveButtons(!1)}})):(u.remove_spinner(e),u.toggleSaveButtons(!1))},update_membership_status:function(a){u.prepend_spinner(a.parents(".row-actions")),a.attr("disabled",!0);var s=a.prop("checked"),i=a.data("ur-membership-id");this.send_data({action:"user_registration_membership_update_membership_status",membership_data:JSON.stringify({status:s,ID:i})},{success:function(e){e.success?u.show_success_message(e.data.message):u.show_failure_message(e.data.message)},failure:function(e,t){u.show_failure_message(p.labels.network_error+"("+t+")")},complete:function(){u.remove_spinner(a.parents(".row-actions")),a.attr("disabled",!1);var e=s?"Active":"Inactive",t=l("#ur-membership-list-status-"+i);t.text(e),"Inactive"==e?(t.removeClass("user-registration-badge--success-subtle"),t.addClass("user-registration-badge--secondary-subtle")):(t.removeClass("user-registration-badge--secondary-subtle"),t.addClass("user-registration-badge--success-subtle"))}})},send_data:function(e,t){var a="function"==typeof t.success?t.success:function(){},s="function"==typeof t.failure?t.failure:function(){},i="function"==typeof t.beforeSend?t.beforeSend:function(){},t="function"==typeof t.complete?t.complete:function(){};!e._wpnonce&&p&&(e._wpnonce=p._nonce),l.ajax({type:"post",dataType:"json",url:p.ajax_url,data:e,beforeSend:i,success:a,error:s,complete:t})},remove_deleted_memberships:function(e,t){t?e.each(function(){l(this).parents("tr").remove()}):l(e).parents("tr").remove()}};l(document).on("click","input:radio[name=ur_membership_type]",function(){var e=l(this).val(),t=l("#paid-plan-container"),a=l(".ur-membership-subscription-field-container"),s=l("#payment-gateway-container");t.addClass("ur-d-none"),t.addClass("ur-d-none"),s.addClass("ur-d-none"),a.show(),"free"!==e&&("paid"===e?a.hide():a.removeClass("ur-d-none"),s.removeClass("ur-d-none"),t.removeClass("ur-d-none"))}),l(".ur-membership-save-btn").on("click",function(e){e.preventDefault(),e.stopPropagation();e=l(this);p.membership_id&&""!==p.membership_id?i.update_membership(e):i.create_membership(e)}),l("#ur-membership-trial-status").on("click",function(){var e=l(this).prop("checked"),t=l(".trial-container");l(this).val("on"),e||l(this).val("off"),t.toggleClass("ur-d-none")}),l(".ur-membership-change-status").on("change",function(){i.update_membership_status(l(this))}),l(document).on("click",".ur-payment-option-header",function(){l(this).hasClass("closed")?l(this).removeClass("closed"):l(this).addClass("closed");var e=l(this).attr("id");l('div[data-target-id="'+e+'"]').slideToggle(),l(this).find(".ur-pg-arrow").toggleClass("expand")}),l(document).on("click",".pg-switch",function(e){e.stopImmediatePropagation(),"ur-membership-pg-stripe"!==l(this).attr("id")||!l(this).is(":checked")||""!==l("#ur-input-type-publishable-key").val()&&""!==l("#ur-input-type-secret-key").val()||(u.show_failure_message(p.labels.i18n_stripe_setup_error),l(this).prop("checked",!1))}),l(".delete-membership").on("click",function(e){e.preventDefault(),e.stopPropagation();var t=l(this);Swal.fire({title:'<img src="'+p.delete_icon+'" id="delete-user-icon">'+p.labels.i18n_prompt_title,html:'<p id="html_1">'+p.labels.i18n_prompt_single_subtitle+"</p>",showCancelButton:!0,confirmButtonText:p.labels.i18n_prompt_delete,cancelButtonText:p.labels.i18n_prompt_cancel,allowOutsideClick:!1}).then(function(e){e.isConfirmed&&l(location).attr("href",t.attr("href"))})}),l("#membership-list #doaction,#doaction2").on("click",function(e){e.preventDefault(),e.stopPropagation();e=l("#membership-list");"delete"===e.find("select#bulk-action-selector-top option:selected").val()&&u.handle_bulk_delete_action(e)})}(jQuery,window.ur_membership_localized_data);