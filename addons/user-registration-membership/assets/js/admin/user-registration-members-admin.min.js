!function(i,o){i(".user-membership-enhanced-select2").select2(),UR_Snackbar&&(t=new UR_Snackbar);var t,u={convert_to_array:function(e){return Object.values(e).reverse().slice(2).reverse()},append_spinner:function(e){return!(!e||!e.append||(e.append('<span class="ur-spinner is-active"></span>'),0))},prepend_spinner:function(e){return!(!e||!e.prepend||(e.prepend('<span class="ur-spinner is-active"></span>'),0))},remove_spinner:function(e){return!(!e||!e.remove||(e.find(".ur-spinner").remove(),0))},if_empty:function(e,t){return null===e||undefined===e||""===e?t:e},toggleSaveButtons:function(e){e=this.if_empty(e,!0),i(".ur-member-save-btn").prop("disabled",!!e)},show_success_message:function(e){return!!t&&(t.add({type:"success",message:e,duration:5}),!0)},show_failure_message:function(e){return!!t&&(t.add({type:"failure",message:e,duration:6}),!0)}},r={prepare_members_data:function(){var n={},e=i(".ur-membership-members-input");return(e=u.convert_to_array(e)).forEach(function(e){var e=i(e),t=e.data("key-name").toLowerCase();n[t]=e.is('input[type="checkbox"]')?e.prop("checked"):e.val()}),n},validate_membership_form:function(){var e=i("#ur-membership-create-form").find("input"),s=new RegExp("^[a-zA-Z0-9._%+-]+@(?:[a-zA-Z0-9-]+\\.)+[a-zA-Z]{2,}$"),r=(new Date).toISOString().split("T")[0],a=!0;return(e=u.convert_to_array(e)).every(function(e){var e=i(e),t=e.val(),n=e.attr("required"),e=e.data("key-name");return n&&""===t?(a=!1,u.show_failure_message(o.labels.i18n_error+"! "+e+" "+o.labels.i18n_field_is_required),!1):"Email"!==e||s.test(t)?"Password"===e&&t!==i("#ur-input-type-membership-confirm-password").val()?(a=!1,u.show_failure_message(o.labels.i18n_field_password_field_validation),!1):!("start_date"===e&&t<r&&(a=!1,u.show_failure_message(o.labels.i18n_field_subscription_start_date_validation),1)):(a=!1,u.show_failure_message(o.labels.i18n_field_email_field_validation),!1)}),a},create_member:function(e){var t;u.toggleSaveButtons(!0),u.append_spinner(e),this.validate_membership_form()?(t=this.prepare_members_data(),this.send_data({action:"user_registration_membership_create_member",members_data:JSON.stringify(t)},{success:function(e){e.success?(o.member_id=e.data.member_id,i(".ur-member-save-btn").hide(),u.show_success_message(e.data.message)):u.show_failure_message(e.data.message)},failure:function(e,t){u.show_failure_message(o.labels.network_error+"("+t+")")},complete:function(){u.remove_spinner(e),u.toggleSaveButtons(!1)}})):(u.remove_spinner(e),u.toggleSaveButtons(!1))},update_member:function(e){},update_membership_status:function(e){},send_data:function(e,t){var n="function"==typeof t.success?t.success:function(){},s="function"==typeof t.failure?t.failure:function(){},r="function"==typeof t.beforeSend?t.beforeSend:function(){},t="function"==typeof t.complete?t.complete:function(){};!e._wpnonce&&o&&(e._wpnonce=o._nonce),i.ajax({type:"post",dataType:"json",url:o.ajax_url,data:e,beforeSend:r,success:n,error:s,complete:t})},handle_bulk_delete_action:function(s){Swal.fire({title:'<img src="'+o.delete_icon+'" id="delete-user-icon">'+o.labels.i18n_prompt_title,html:'<p id="html_1">'+o.labels.i18n_prompt_bulk_subtitle+"</p>",showCancelButton:!0,confirmButtonText:o.labels.i18n_prompt_delete,cancelButtonText:o.labels.i18n_prompt_cancel,allowOutsideClick:!1}).then(function(e){var t,n;e.isConfirmed&&(t=s.find('input[name="users[]"]:checked'),n=[],t.length<1?u.show_failure_message(o.labels.i18n_prompt_no_membership_selected):(t.each(function(){""!==i(this).val()&&n.push(i(this).val())}),r.send_data({action:"user_registration_membership_delete_members",members_ids:JSON.stringify(n)},{success:function(e){e.success?(u.show_success_message(e.data.message),r.remove_deleted_members(t,!0)):u.show_failure_message(e.data.message)},failure:function(e,t){u.show_failure_message(o.labels.network_error+"("+t+")")},complete:function(){}})))})},remove_deleted_members:function(e,t){t?e.each(function(){i(this).parents("tr").remove()}):i(e).parents("tr").remove()}};i(".ur-member-save-btn").on("click",function(e){e.preventDefault(),e.stopPropagation();e=i(this);o.member_id&&""!==o.member_id?r.update_member(e):r.create_member(e)}),i("#user-registration-members-list-form #doaction,#doaction2").on("click",function(e){e.preventDefault(),e.stopPropagation();e=i("#user-registration-members-list-form");"delete"===e.find("select#bulk-action-selector-top option:selected").val()&&r.handle_bulk_delete_action(e)})}(jQuery,window.ur_members_localized_data);